import { _ as _export_sfc, c as createElementBlock, o as openBlock, a as createStaticVNode } from "./app.222b9ad1.js";
const __pageData = JSON.parse('{"title":"\u4ECB\u7ECD","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u7B80\u4ECB","slug":"\u7B80\u4ECB","link":"#\u7B80\u4ECB","children":[]},{"level":2,"title":"\u51FD\u6570\u5217\u8868","slug":"\u51FD\u6570\u5217\u8868","link":"#\u51FD\u6570\u5217\u8868","children":[]},{"level":2,"title":"\u805A\u5408\u51FD\u6570","slug":"\u805A\u5408\u51FD\u6570","link":"#\u805A\u5408\u51FD\u6570","children":[]},{"level":2,"title":"cume_dist\u51FD\u6570","slug":"cume-dist\u51FD\u6570","link":"#cume-dist\u51FD\u6570","children":[]},{"level":2,"title":"dense_rank\u51FD\u6570","slug":"dense-rank\u51FD\u6570","link":"#dense-rank\u51FD\u6570","children":[]},{"level":2,"title":"ntile\u51FD\u6570","slug":"ntile\u51FD\u6570","link":"#ntile\u51FD\u6570","children":[]},{"level":2,"title":"percent_rank\u51FD\u6570","slug":"percent-rank\u51FD\u6570","link":"#percent-rank\u51FD\u6570","children":[]},{"level":2,"title":"rank\u51FD\u6570","slug":"rank\u51FD\u6570","link":"#rank\u51FD\u6570","children":[]},{"level":2,"title":"row_number\u51FD\u6570","slug":"row-number\u51FD\u6570","link":"#row-number\u51FD\u6570","children":[]},{"level":2,"title":"first_value\u51FD\u6570","slug":"first-value\u51FD\u6570","link":"#first-value\u51FD\u6570","children":[]},{"level":2,"title":"last_value\u51FD\u6570","slug":"last-value\u51FD\u6570","link":"#last-value\u51FD\u6570","children":[]},{"level":2,"title":"lag\u51FD\u6570","slug":"lag\u51FD\u6570","link":"#lag\u51FD\u6570","children":[]},{"level":2,"title":"lead\u51FD\u6570","slug":"lead\u51FD\u6570","link":"#lead\u51FD\u6570","children":[]},{"level":2,"title":"nth_value\u51FD\u6570","slug":"nth-value\u51FD\u6570","link":"#nth-value\u51FD\u6570","children":[]}],"relativePath":"sqlfun/13\u7A97\u53E3\u51FD\u6570\uFF08\u5F85\u5904\u7406\uFF09.md"}');
const _sfc_main = { name: "sqlfun/13\u7A97\u53E3\u51FD\u6570\uFF08\u5F85\u5904\u7406\uFF09.md" };
const _hoisted_1 = /* @__PURE__ */ createStaticVNode('<h1 id="\u4ECB\u7ECD" tabindex="-1">\u4ECB\u7ECD <a class="header-anchor" href="#\u4ECB\u7ECD" aria-hidden="true">#</a></h1><p>\u672C\u6587\u4ECB\u7ECD\u7A97\u53E3\u51FD\u6570\u7684\u57FA\u672C\u8BED\u6CD5\u53CA\u793A\u4F8B\u3002</p><h1 id="\u51FD\u6570\u793A\u4F8B" tabindex="-1">\u51FD\u6570\u793A\u4F8B <a class="header-anchor" href="#\u51FD\u6570\u793A\u4F8B" aria-hidden="true">#</a></h1><h2 id="\u7B80\u4ECB" tabindex="-1">\u7B80\u4ECB <a class="header-anchor" href="#\u7B80\u4ECB" aria-hidden="true">#</a></h2><p>\u666E\u901A\u7684\u805A\u5408\u51FD\u6570\u53EA\u80FD\u7528\u6765\u8BA1\u7B97\u4E00\u884C\u5185\u7684\u7ED3\u679C\u6216\u628A\u6240\u6709\u884C\u805A\u5408\u6210\u4E00\u884C\u7ED3\u679C\uFF0C\u800C\u7A97\u53E3\u51FD\u6570\u652F\u6301\u4E3A\u6BCF\u4E00\u884C\u751F\u6210\u4E00\u4E2A\u7ED3\u679C\u3002\u7A97\u53E3\u51FD\u6570\u5305\u542B\u5206\u533A\u3001\u6392\u5E8F\u548C\u6846\u67B6\u8FD93\u4E2A\u6838\u5FC3\u5143\u7D20\u3002\u66F4\u591A\u4FE1\u606F\uFF0C\u8BF7\u53C2\u89C1<a href="https://dev.mysql.com/doc/refman/8.0/en/window-functions-usage.html" target="_blank" rel="noreferrer">Window Function Concepts and Syntax</a>\u3002</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki"><code><span class="line"><span style="color:#F78C6C;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">over</span><span style="color:#A6ACCD;"> (</span></span>\n<span class="line"><span style="color:#A6ACCD;">    [partition by partition_expression]</span></span>\n<span class="line"><span style="color:#A6ACCD;">    [order by order_expression]</span></span>\n<span class="line"><span style="color:#A6ACCD;">    [frame]</span></span>\n<span class="line"><span style="color:#A6ACCD;">)</span></span>\n<span class="line"></span></code></pre></div><ul><li><p>\u5206\u533A\uFF1A\u5206\u533A\u5143\u7D20\u7531partition by\u5B50\u53E5\u5B9A\u4E49\u3002partition by\u5B50\u53E5\u7528\u4E8E\u5212\u5206\u7A97\u53E3\u5206\u533A\uFF0C\u5982\u679C\u6CA1\u6709\u6307\u5B9Apartition by\u5B50\u53E5\uFF0C\u5219\u6574\u4E2A\u67E5\u8BE2\u4E0E\u5206\u6790\u7ED3\u679C\u96C6\u4F5C\u4E3A\u4E00\u4E2A\u7A97\u53E3\u5206\u533A\u3002</p></li><li><p>\u6392\u5E8F\uFF1A\u6392\u5E8F\u5143\u7D20\u7531order by\u5B50\u53E5\u5B9A\u4E49\u3002order by\u5B50\u53E5\u7528\u4E8E\u5BF9\u7A97\u53E3\u5206\u533A\u5185\u7684\u884C\u8FDB\u884C\u6392\u5E8F\u3002 <strong>\u8BF4\u660E</strong> \u4F7F\u7528order by\u5B50\u53E5\u5BF9\u91CD\u590D\u7684\u6570\u503C\u8FDB\u884C\u6392\u5E8F\u65F6\uFF0C\u6392\u5E8F\u7ED3\u679C\u4E0D\u7A33\u5B9A\u3002\u5982\u679C\u60A8\u5E0C\u671B\u6BCF\u6B21\u6392\u5E8F\u7ED3\u679C\u76F8\u540C\uFF0C\u53EF\u6307\u5B9A\u591A\u4E2A\u5217\u8FDB\u884C\u6392\u5E8F\u3002\u4F8B\u5982<code>order by request_time, request_method</code>\u3002</p></li><li><p>\u6846\u67B6\uFF1A\u6846\u67B6\u5143\u7D20\u5728\u7A97\u53E3\u5206\u533A\u5185\u5BF9\u884C\u8FDB\u4E00\u6B65\u9650\u5236\u3002\u6846\u67B6\u5143\u7D20\u4E0D\u9002\u7528\u4E8E\u6392\u540D\u51FD\u6570\u3002\u6846\u67B6\u5B50\u53E5\u7684\u8BED\u6CD5\u4E3A<code>{ rows | range} { frame_start | frame_between }</code>\uFF0C\u4F8B\u5982<code>range between unbounded preceding and unbounded following</code>\u3002\u66F4\u591A\u4FE1\u606F\uFF0C\u8BF7\u53C2\u89C1<a href="https://dev.mysql.com/doc/refman/8.0/en/window-functions-frames.html" target="_blank" rel="noreferrer">Window Function Frame Specification</a>\u3002</p></li></ul><h2 id="\u51FD\u6570\u5217\u8868" tabindex="-1">\u51FD\u6570\u5217\u8868 <a class="header-anchor" href="#\u51FD\u6570\u5217\u8868" aria-hidden="true">#</a></h2><table><thead><tr><th>\u5206\u7C7B</th><th>\u51FD\u6570\u540D\u79F0</th><th>\u8BED\u6CD5</th><th>\u8BF4\u660E</th></tr></thead><tbody><tr><td>\u805A\u5408\u51FD\u6570</td><td><a href="#%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0">\u805A\u5408\u51FD\u6570</a></td><td>\u65E0</td><td>\u6240\u6709\u805A\u5408\u51FD\u6570\u90FD\u652F\u6301\u5728\u7A97\u53E3\u51FD\u6570\u4E2D\u4F7F\u7528\u3002\u805A\u5408\u51FD\u6570\u5217\u8868\u8BF7\u53C2\u89C1<a href="https://sls.aliyun.com/function/functionInfo.html?detail_id=1" target="_blank" rel="noreferrer">\u805A\u5408\u51FD\u6570</a>\u3002</td></tr><tr><td>\u6392\u540D\u51FD\u6570</td><td><a href="#cume_dist%E5%87%BD%E6%95%B0">cume_dist\u51FD\u6570</a></td><td>cume_dist()</td><td>\u7EDF\u8BA1\u7A97\u53E3\u5206\u533A\u5185\u5404\u4E2A\u503C\u7684\u7D2F\u8BA1\u5206\u5E03\u3002\u5373\u8BA1\u7B97\u7A97\u53E3\u5206\u533A\u5185\u503C\u5C0F\u4E8E\u7B49\u4E8E\u5F53\u524D\u503C\u7684\u884C\u6570\u5360\u7A97\u53E3\u5185\u603B\u884C\u6570\u7684\u6BD4\u4F8B\u3002\u8FD4\u56DE\u503C\u8303\u56F4\u4E3A(0,1]\u3002</td></tr><tr><td>\u6392\u540D\u51FD\u6570</td><td><a href="#dense_rank%E5%87%BD%E6%95%B0">dense_rank\u51FD\u6570</a></td><td>dense_rank()</td><td>\u7A97\u53E3\u5206\u533A\u5185\u503C\u7684\u6392\u540D\u3002\u76F8\u540C\u503C\u62E5\u6709\u76F8\u540C\u7684\u6392\u540D\uFF0C\u6392\u540D\u662F\u8FDE\u7EED\u7684\uFF0C\u4F8B\u5982\u6709\u4E24\u4E2A\u76F8\u540C\u503C\u7684\u6392\u540D\u4E3A1\uFF0C\u5219\u4E0B\u4E00\u4E2A\u503C\u7684\u6392\u540D\u4E3A2\u3002</td></tr><tr><td>\u6392\u540D\u51FD\u6570</td><td><a href="#ntile%E5%87%BD%E6%95%B0">ntile\u51FD\u6570</a></td><td>ntile( <em>n</em> )</td><td>\u5C06\u7A97\u53E3\u5206\u533A\u5185\u6570\u636E\u6309\u7167\u987A\u5E8F\u5206\u6210N\u7EC4\u3002</td></tr><tr><td>\u6392\u540D\u51FD\u6570</td><td><a href="#percent_rank%E5%87%BD%E6%95%B0">percent_rank\u51FD\u6570</a></td><td>percent_rank()</td><td>\u8BA1\u7B97\u7A97\u53E3\u5206\u533A\u5185\u5404\u884C\u7684\u767E\u5206\u6BD4\u6392\u540D\u3002</td></tr><tr><td>\u6392\u540D\u51FD\u6570</td><td><a href="#rank%E5%87%BD%E6%95%B0">rank\u51FD\u6570</a></td><td>rank()</td><td>\u7A97\u53E3\u5206\u533A\u5185\u503C\u7684\u6392\u540D\u3002\u76F8\u540C\u503C\u62E5\u6709\u76F8\u540C\u7684\u6392\u540D\uFF0C\u6392\u540D\u4E0D\u662F\u8FDE\u7EED\u7684\uFF0C\u4F8B\u5982\u6709\u4E24\u4E2A\u76F8\u540C\u503C\u7684\u6392\u540D\u4E3A1\uFF0C\u5219\u4E0B\u4E00\u4E2A\u503C\u7684\u6392\u540D\u4E3A3\u3002</td></tr><tr><td>\u6392\u540D\u51FD\u6570</td><td><a href="#row_number%E5%87%BD%E6%95%B0">row_number\u51FD\u6570</a></td><td>row_number()</td><td>\u7A97\u53E3\u5206\u533A\u5185\u503C\u7684\u6392\u540D\u3002\u6BCF\u4E2A\u503C\u62E5\u6709\u552F\u4E00\u7684\u5E8F\u53F7\uFF0C\u4ECE1\u5F00\u59CB\u3002\u4E09\u4E2A\u76F8\u540C\u503C\u7684\u6392\u540D\u4E3A1\u30012\u30013\u3002</td></tr><tr><td>\u504F\u79FB\u51FD\u6570</td><td><a href="#first_value%E5%87%BD%E6%95%B0">first_value\u51FD\u6570</a></td><td>first_value( <em>x</em> )</td><td>\u8FD4\u56DE\u5404\u4E2A\u7A97\u53E3\u5206\u533A\u5185\u7B2C\u4E00\u884C\u7684\u503C\u3002</td></tr><tr><td>\u504F\u79FB\u51FD\u6570</td><td><a href="#last_value%E5%87%BD%E6%95%B0">last_value\u51FD\u6570</a></td><td>last_value( <em>x</em> )</td><td>\u8FD4\u56DE\u5404\u4E2A\u7A97\u53E3\u5206\u533A\u5185\u6700\u540E\u4E00\u884C\u7684\u503C\u3002</td></tr><tr><td>\u504F\u79FB\u51FD\u6570</td><td><a href="#lag%E5%87%BD%E6%95%B0">lag\u51FD\u6570</a></td><td>lag( <em>x</em> , <em>offset</em> , <em>defaut_value</em> )</td><td>\u8FD4\u56DE\u7A97\u53E3\u5206\u533A\u5185\u4F4D\u4E8E\u5F53\u524D\u884C\u4E0A\u65B9\u7B2C <em>offset</em> \u884C\u7684\u503C\u3002\u5982\u679C\u4E0D\u5B58\u5728\u8BE5\u884C\uFF0C\u5219\u8FD4\u56DE <em>defaut_value</em> \u3002</td></tr><tr><td>\u504F\u79FB\u51FD\u6570</td><td><a href="#lead%E5%87%BD%E6%95%B0">lead\u51FD\u6570</a></td><td>lead( <em>x</em> , <em>offset</em> , <em>defaut_value</em> )</td><td>\u8FD4\u56DE\u7A97\u53E3\u5206\u533A\u5185\u4F4D\u4E8E\u5F53\u524D\u884C\u4E0B\u65B9\u7B2C <em>offset</em> \u884C\u7684\u503C\u3002\u5982\u679C\u4E0D\u5B58\u5728\u8BE5\u884C\uFF0C\u5219\u8FD4\u56DE <em>defaut_value</em> \u3002</td></tr><tr><td>\u504F\u79FB\u51FD\u6570</td><td><a href="#nth_value%E5%87%BD%E6%95%B0">nth_value\u51FD\u6570</a></td><td>nth_value( <em>x</em> , <em>offset</em> )</td><td>\u8FD4\u56DE\u7A97\u53E3\u5206\u533A\u4E2D\u7B2C <em>offset</em> \u884C\u7684\u503C\u3002</td></tr></tbody></table><h1 id="\u6848\u4F8B" tabindex="-1">\u6848\u4F8B <a class="header-anchor" href="#\u6848\u4F8B" aria-hidden="true">#</a></h1><h2 id="\u805A\u5408\u51FD\u6570" tabindex="-1">\u805A\u5408\u51FD\u6570 <a class="header-anchor" href="#\u805A\u5408\u51FD\u6570" aria-hidden="true">#</a></h2><p>\u6240\u6709\u805A\u5408\u51FD\u6570\u90FD\u652F\u6301\u5728\u7A97\u53E3\u51FD\u6570\u4E2D\u4F7F\u7528\u3002\u805A\u5408\u51FD\u6570\u5217\u8868\u8BF7\u53C2\u89C1<a href="https://sls.aliyun.com/function/functionInfo.html?detail_id=1" target="_blank" rel="noreferrer">\u805A\u5408\u51FD\u6570</a>\u3002\u6B64\u5904\u4EE5sum\u51FD\u6570\u4E3A\u4F8B\u3002</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki"><code><span class="line"><span style="color:#82AAFF;">sum</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">over</span><span style="color:#A6ACCD;"> (</span></span>\n<span class="line"><span style="color:#A6ACCD;">    [partition by partition_expression]</span></span>\n<span class="line"><span style="color:#A6ACCD;">    [order by order_expression]</span></span>\n<span class="line"><span style="color:#A6ACCD;">    [frame]</span></span>\n<span class="line"><span style="color:#A6ACCD;">)</span></span>\n<span class="line"></span></code></pre></div><table><thead><tr><th>\u53C2\u6570</th><th>\u8BF4\u660E</th></tr></thead><tbody><tr><td>partition by <em>partition_expression</em></td><td>\u7A97\u53E3\u5206\u533A\uFF0C\u6839\u636E\u5206\u533A\u8868\u8FBE\u5F0F\u5C06\u6570\u636E\u5212\u5206\u6210\u4E0D\u540C\u7684\u5206\u533A\u3002</td></tr><tr><td>order by <em>order_expression</em></td><td>\u7A97\u53E3\u6392\u5E8F\uFF0C\u6839\u636E\u6392\u5E8F\u8868\u8FBE\u5F0F\u5BF9\u5404\u4E2A\u5206\u533A\u5185\u7684\u6BCF\u4E00\u884C\u8FDB\u884C\u6392\u5E8F\u3002</td></tr><tr><td><em>frame</em></td><td>\u7A97\u53E3\u6846\u67B6\uFF0C\u4F8B\u5982<code>range between unbounded preceding and unbounded following</code>\u3002</td></tr></tbody></table><p>double\u7C7B\u578B\u3002</p><p>\u6309\u7167\u90E8\u95E8\u5206\u533A\uFF0C\u83B7\u53D6\u6BCF\u4E2A\u5458\u5DE5\u85AA\u6C34\u5728\u90E8\u95E8\u5185\u7684\u5360\u6BD4\u3002</p><ul><li><p>\u67E5\u8BE2\u548C\u5206\u6790\u8BED\u53E5</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> |</span></span>\n<span class="line"><span style="color:#F78C6C;">SELECT</span></span>\n<span class="line"><span style="color:#A6ACCD;">  department,</span></span>\n<span class="line"><span style="color:#A6ACCD;">  staff_name,</span></span>\n<span class="line"><span style="color:#A6ACCD;">  salary,</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">round</span><span style="color:#A6ACCD;"> ( salary </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">sum</span><span style="color:#A6ACCD;">(salary) </span><span style="color:#F78C6C;">over</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">partition</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">by</span><span style="color:#A6ACCD;"> department), </span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> salary_percentage </span></span>\n<span class="line"></span></code></pre></div></li><li><p>\u67E5\u8BE2\u548C\u5206\u6790\u7ED3\u679C</p><p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/7115699261/p312606.png" alt="sum"></p></li></ul><h2 id="cume-dist\u51FD\u6570" tabindex="-1">cume_dist\u51FD\u6570 <a class="header-anchor" href="#cume-dist\u51FD\u6570" aria-hidden="true">#</a></h2><p>cume_dist\u51FD\u6570\u7528\u4E8E\u7EDF\u8BA1\u7A97\u53E3\u5206\u533A\u5185\u5404\u4E2A\u503C\u7684\u7D2F\u8BA1\u5206\u5E03\u3002\u5373\u8BA1\u7B97\u7A97\u53E3\u5206\u533A\u5185\u503C\u5C0F\u4E8E\u7B49\u4E8E\u5F53\u524D\u503C\u7684\u884C\u6570\u5360\u7A97\u53E3\u5185\u603B\u884C\u6570\u7684\u6BD4\u4F8B\u3002\u8FD4\u56DE\u503C\u8303\u56F4\u4E3A(0,1]\u3002</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki"><code><span class="line"><span style="color:#82AAFF;">cume_dist</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">over</span><span style="color:#A6ACCD;"> (</span></span>\n<span class="line"><span style="color:#A6ACCD;">    [partition by partition_expression]</span></span>\n<span class="line"><span style="color:#A6ACCD;">    [order by order_expression]</span></span>\n<span class="line"><span style="color:#A6ACCD;">)</span></span>\n<span class="line"></span></code></pre></div><table><thead><tr><th>\u53C2\u6570</th><th>\u8BF4\u660E</th></tr></thead><tbody><tr><td>partition by <em>partition_expression</em></td><td>\u7A97\u53E3\u5206\u533A\uFF0C\u6839\u636E\u5206\u533A\u8868\u8FBE\u5F0F\u5C06\u6570\u636E\u5212\u5206\u6210\u4E0D\u540C\u7684\u5206\u533A\u3002</td></tr><tr><td>order by <em>order_expression</em></td><td>\u7A97\u53E3\u6392\u5E8F\uFF0C\u6839\u636E\u6392\u5E8F\u8868\u8FBE\u5F0F\u5BF9\u5404\u4E2A\u5206\u533A\u5185\u7684\u6BCF\u4E00\u884C\u8FDB\u884C\u6392\u5E8F\u3002</td></tr></tbody></table><p>double\u7C7B\u578B\u3002</p><p>\u7EDF\u8BA1\u540D\u4E3Abucket00788\u7684OSS Bucket\u5185\u5404\u4E2A\u5BF9\u8C61\u7684\u5927\u5C0F\u7684\u7D2F\u8BA1\u5206\u5E03\u3002</p><ul><li><p>\u67E5\u8BE2\u548C\u5206\u6790\u8BED\u53E5</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">bucket</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">bucket00788 |</span></span>\n<span class="line"><span style="color:#F78C6C;">select</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">object</span><span style="color:#A6ACCD;">,</span></span>\n<span class="line"><span style="color:#A6ACCD;">  object_size,</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">cume_dist</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">over</span><span style="color:#A6ACCD;"> (</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">partition</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">by</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">object</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">order by</span></span>\n<span class="line"><span style="color:#A6ACCD;">      object_size</span></span>\n<span class="line"><span style="color:#A6ACCD;">  ) </span><span style="color:#F78C6C;">as</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">cume_dist</span></span>\n<span class="line"><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;">  oss</span><span style="color:#89DDFF;">-</span><span style="color:#82AAFF;">log</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">store</span></span>\n<span class="line"></span></code></pre></div></li><li><p>\u67E5\u8BE2\u548C\u5206\u6790\u7ED3\u679C</p><p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/6621499261/p310518.png" alt="cume_dist"></p></li></ul><h2 id="dense-rank\u51FD\u6570" tabindex="-1">dense_rank\u51FD\u6570 <a class="header-anchor" href="#dense-rank\u51FD\u6570" aria-hidden="true">#</a></h2><p>dense_rank\u51FD\u6570\u7528\u4E8E\u7A97\u53E3\u5206\u533A\u5185\u503C\u7684\u6392\u540D\u3002\u76F8\u540C\u503C\u62E5\u6709\u76F8\u540C\u7684\u6392\u540D\uFF0C\u6392\u540D\u662F\u8FDE\u7EED\u7684\uFF0C\u4F8B\u5982\u6709\u4E24\u4E2A\u76F8\u540C\u503C\u7684\u6392\u540D\u4E3A1\uFF0C\u5219\u4E0B\u4E00\u4E2A\u503C\u7684\u6392\u540D\u4E3A2\u3002</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki"><code><span class="line"><span style="color:#82AAFF;">dense_rank</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">over</span><span style="color:#A6ACCD;"> (</span></span>\n<span class="line"><span style="color:#A6ACCD;">    [partition by partition_expression]</span></span>\n<span class="line"><span style="color:#A6ACCD;">    [order by order_expression]</span></span>\n<span class="line"><span style="color:#A6ACCD;">)</span></span>\n<span class="line"></span></code></pre></div><table><thead><tr><th>\u53C2\u6570</th><th>\u8BF4\u660E</th></tr></thead><tbody><tr><td>partition by <em>partition_expression</em></td><td>\u7A97\u53E3\u5206\u533A\uFF0C\u6839\u636E\u5206\u533A\u8868\u8FBE\u5F0F\u5C06\u6570\u636E\u5212\u5206\u6210\u4E0D\u540C\u7684\u5206\u533A\u3002</td></tr><tr><td>order by <em>order_expression</em></td><td>\u7A97\u53E3\u6392\u5E8F\uFF0C\u6839\u636E\u6392\u5E8F\u8868\u8FBE\u5F0F\u5BF9\u5404\u4E2A\u5206\u533A\u5185\u7684\u6BCF\u4E00\u884C\u8FDB\u884C\u6392\u5E8F\u3002</td></tr></tbody></table><p>bigint\u7C7B\u578B\u3002</p><p>\u6309\u7167\u90E8\u95E8\u5206\u533A\uFF0C\u8BA1\u7B97\u5458\u5DE5\u85AA\u6C34\u5728\u90E8\u95E8\u5185\u7684\u6392\u540D\u3002</p><ul><li><p>\u67E5\u8BE2\u548C\u5206\u6790\u8BED\u53E5</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> |</span></span>\n<span class="line"><span style="color:#F78C6C;">select</span></span>\n<span class="line"><span style="color:#A6ACCD;">  department,</span></span>\n<span class="line"><span style="color:#A6ACCD;">  staff_name,</span></span>\n<span class="line"><span style="color:#A6ACCD;">  salary,</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">dense_rank</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">over</span><span style="color:#A6ACCD;">(</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">partition</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">by</span><span style="color:#A6ACCD;"> department</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">order by</span></span>\n<span class="line"><span style="color:#A6ACCD;">      salary </span><span style="color:#F78C6C;">desc</span></span>\n<span class="line"><span style="color:#A6ACCD;">  ) </span><span style="color:#F78C6C;">as</span><span style="color:#A6ACCD;"> salary_rank</span></span>\n<span class="line"><span style="color:#F78C6C;">order by</span></span>\n<span class="line"><span style="color:#A6ACCD;">  department,</span></span>\n<span class="line"><span style="color:#A6ACCD;">  salary_rank</span></span>\n<span class="line"></span></code></pre></div></li><li><p>\u67E5\u8BE2\u548C\u5206\u6790\u7ED3\u679C</p><p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/7115699261/p312291.png" alt="dense_rank"></p></li></ul><h2 id="ntile\u51FD\u6570" tabindex="-1">ntile\u51FD\u6570 <a class="header-anchor" href="#ntile\u51FD\u6570" aria-hidden="true">#</a></h2><p>ntile\u51FD\u6570\u7528\u4E8E\u5C06\u7A97\u53E3\u5206\u533A\u5185\u6570\u636E\u6309\u7167\u987A\u5E8F\u5206\u6210N\u7EC4\u3002</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki"><code><span class="line"><span style="color:#82AAFF;">ntile</span><span style="color:#A6ACCD;">(n) </span><span style="color:#F78C6C;">over</span><span style="color:#A6ACCD;"> (</span></span>\n<span class="line"><span style="color:#A6ACCD;">    [partition by partition_expression]</span></span>\n<span class="line"><span style="color:#A6ACCD;">    [order by order_expression]</span></span>\n<span class="line"><span style="color:#A6ACCD;">)</span></span>\n<span class="line"></span></code></pre></div><table><thead><tr><th>\u53C2\u6570</th><th>\u8BF4\u660E</th></tr></thead><tbody><tr><td><em>n</em></td><td>\u7EC4\u6570\u3002</td></tr><tr><td>partition by <em>partition_expression</em></td><td>\u7A97\u53E3\u5206\u533A\uFF0C\u6839\u636E\u5206\u533A\u8868\u8FBE\u5F0F\u5C06\u6570\u636E\u5212\u5206\u6210\u4E0D\u540C\u7684\u5206\u533A\u3002</td></tr><tr><td>order by <em>order_expression</em></td><td>\u7A97\u53E3\u6392\u5E8F\uFF0C\u6839\u636E\u6392\u5E8F\u8868\u8FBE\u5F0F\u5BF9\u5404\u4E2A\u5206\u533A\u5185\u7684\u6BCF\u4E00\u884C\u8FDB\u884C\u6392\u5E8F\u3002</td></tr></tbody></table><p>bigint\u7C7B\u578B\u3002</p><p>\u5C06\u6307\u5B9A\u5BF9\u8C61\u4E2D\u7684\u6570\u636E\u5206\u62103\u7EC4\u3002</p><ul><li><p>\u67E5\u8BE2\u548C\u5206\u6790\u8BED\u53E5</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki"><code><span class="line"><span style="color:#F78C6C;">object</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">245</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">da918c.model |</span></span>\n<span class="line"><span style="color:#F78C6C;">select</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">object</span><span style="color:#A6ACCD;">,</span></span>\n<span class="line"><span style="color:#A6ACCD;">  object_size,</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">ntile</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">over</span><span style="color:#A6ACCD;"> (</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">partition</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">by</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">object</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">order by</span></span>\n<span class="line"><span style="color:#A6ACCD;">      object_size</span></span>\n<span class="line"><span style="color:#A6ACCD;">  ) </span><span style="color:#F78C6C;">as</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ntile</span></span>\n<span class="line"><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;">  oss</span><span style="color:#89DDFF;">-</span><span style="color:#82AAFF;">log</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">store</span></span>\n<span class="line"></span></code></pre></div></li><li><p>\u67E5\u8BE2\u548C\u5206\u6790\u7ED3\u679C</p><p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/6621499261/p312373.png" alt="ntile"></p></li></ul><h2 id="percent-rank\u51FD\u6570" tabindex="-1">percent_rank\u51FD\u6570 <a class="header-anchor" href="#percent-rank\u51FD\u6570" aria-hidden="true">#</a></h2><p>\u51FD\u6570\u7528\u4E8E\u8BA1\u7B97\u7A97\u53E3\u5206\u533A\u5185\u5404\u884C\u7684\u767E\u5206\u6BD4\u6392\u540D\u3002\u8BA1\u7B97\u516C\u5F0F\u4E3A<code>(rank - 1) / (total_rows - 1) </code>\uFF0C\u5176\u4E2Drank\u4E3A\u5F53\u524D\u884C\u7684\u6392\u540D\uFF0Ctotal_rows\u4E3A\u5F53\u524D\u7A97\u53E3\u5206\u533A\u5185\u7684\u603B\u884C\u6570\u3002</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki"><code><span class="line"><span style="color:#82AAFF;">percent_rank</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">over</span><span style="color:#A6ACCD;"> (</span></span>\n<span class="line"><span style="color:#A6ACCD;">    [partition by partition_expression]</span></span>\n<span class="line"><span style="color:#A6ACCD;">    [order by order_expression]</span></span>\n<span class="line"><span style="color:#A6ACCD;">)</span></span>\n<span class="line"></span></code></pre></div><table><thead><tr><th>\u53C2\u6570</th><th>\u8BF4\u660E</th></tr></thead><tbody><tr><td>partition by <em>partition_expression</em></td><td>\u7A97\u53E3\u5206\u533A\uFF0C\u6839\u636E\u5206\u533A\u8868\u8FBE\u5F0F\u5C06\u6570\u636E\u5212\u5206\u6210\u4E0D\u540C\u7684\u5206\u533A\u3002</td></tr><tr><td>order by <em>order_expression</em></td><td>\u7A97\u53E3\u6392\u5E8F\uFF0C\u6839\u636E\u6392\u5E8F\u8868\u8FBE\u5F0F\u5BF9\u5404\u4E2A\u5206\u533A\u5185\u7684\u6BCF\u4E00\u884C\u8FDB\u884C\u6392\u5E8F\u3002</td></tr></tbody></table><p>double\u7C7B\u578B\u3002</p><p>\u8BA1\u7B97\u76EE\u6807OSS\u5BF9\u8C61\u7684\u4E0D\u540C\u5927\u5C0F\u7684\u767E\u5206\u6BD4\u6392\u540D\u3002</p><ul><li><p>\u67E5\u8BE2\u548C\u5206\u6790\u8BED\u53E5</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki"><code><span class="line"><span style="color:#F78C6C;">object</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">245</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">da918c3e2dd9dc9cb4d9283b%2F555e2441b6a4c7f094099a6dba8e7a5f.model|</span></span>\n<span class="line"><span style="color:#F78C6C;">select</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">object</span><span style="color:#A6ACCD;">,</span></span>\n<span class="line"><span style="color:#A6ACCD;">  object_size,</span></span>\n<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">percent_rank</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">over</span><span style="color:#A6ACCD;"> (</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">partition</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">by</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">object</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">order by</span></span>\n<span class="line"><span style="color:#A6ACCD;">      object_size</span></span>\n<span class="line"><span style="color:#A6ACCD;">  ) </span><span style="color:#F78C6C;">as</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ntile</span></span>\n<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;">  oss</span><span style="color:#89DDFF;">-</span><span style="color:#82AAFF;">log</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">store</span></span>\n<span class="line"></span></code></pre></div></li><li><p>\u67E5\u8BE2\u548C\u5206\u6790\u7ED3\u679C</p><p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/6621499261/p311497.png" alt="percent_rank"></p></li></ul><h2 id="rank\u51FD\u6570" tabindex="-1">rank\u51FD\u6570 <a class="header-anchor" href="#rank\u51FD\u6570" aria-hidden="true">#</a></h2><p>\u51FD\u6570\u7528\u4E8E\u7A97\u53E3\u5206\u533A\u5185\u503C\u7684\u6392\u540D\u3002\u76F8\u540C\u503C\u62E5\u6709\u76F8\u540C\u7684\u6392\u540D\uFF0C\u6392\u540D\u4E0D\u662F\u8FDE\u7EED\u7684\uFF0C\u4F8B\u5982\u6709\u4E24\u4E2A\u76F8\u540C\u503C\u7684\u6392\u540D\u4E3A1\uFF0C\u5219\u4E0B\u4E00\u4E2A\u503C\u7684\u6392\u540D\u4E3A3\u3002</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki"><code><span class="line"><span style="color:#82AAFF;">rank</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">over</span><span style="color:#A6ACCD;"> (</span></span>\n<span class="line"><span style="color:#A6ACCD;">    [partition by partition_expression]</span></span>\n<span class="line"><span style="color:#A6ACCD;">    [order by order_expression]</span></span>\n<span class="line"><span style="color:#A6ACCD;">)</span></span>\n<span class="line"></span></code></pre></div><table><thead><tr><th>\u53C2\u6570</th><th>\u8BF4\u660E</th></tr></thead><tbody><tr><td>partition by <em>partition_expression</em></td><td>\u7A97\u53E3\u5206\u533A\uFF0C\u6839\u636E\u5206\u533A\u8868\u8FBE\u5F0F\u5C06\u6570\u636E\u5212\u5206\u6210\u4E0D\u540C\u7684\u5206\u533A\u3002</td></tr><tr><td>order by <em>order_expression</em></td><td>\u7A97\u53E3\u6392\u5E8F\uFF0C\u6839\u636E\u6392\u5E8F\u8868\u8FBE\u5F0F\u5BF9\u5404\u4E2A\u5206\u533A\u5185\u7684\u6BCF\u4E00\u884C\u8FDB\u884C\u6392\u5E8F\u3002</td></tr></tbody></table><p>bigint\u7C7B\u578B\u3002</p><p>\u6309\u7167\u90E8\u95E8\u5206\u533A\uFF0C\u8BA1\u7B97\u5458\u5DE5\u85AA\u6C34\u5728\u90E8\u95E8\u5185\u7684\u6392\u540D\u3002</p><ul><li><p>\u67E5\u8BE2\u548C\u5206\u6790\u8BED\u53E5</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> |</span></span>\n<span class="line"><span style="color:#F78C6C;">select</span></span>\n<span class="line"><span style="color:#A6ACCD;">  department,</span></span>\n<span class="line"><span style="color:#A6ACCD;">  staff_name,</span></span>\n<span class="line"><span style="color:#A6ACCD;">  salary,</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">rank</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">over</span><span style="color:#A6ACCD;">(</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">partition</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">by</span><span style="color:#A6ACCD;"> department</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">order by</span></span>\n<span class="line"><span style="color:#A6ACCD;">      salary </span><span style="color:#F78C6C;">desc</span></span>\n<span class="line"><span style="color:#A6ACCD;">  ) </span><span style="color:#F78C6C;">as</span><span style="color:#A6ACCD;"> salary_rank</span></span>\n<span class="line"><span style="color:#F78C6C;">order by</span></span>\n<span class="line"><span style="color:#A6ACCD;">  department,</span></span>\n<span class="line"><span style="color:#A6ACCD;">  salary_rank</span></span>\n<span class="line"></span></code></pre></div></li><li><p>\u67E5\u8BE2\u548C\u5206\u6790\u7ED3\u679C</p><p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/7115699261/p311615.png" alt="rank"></p></li></ul><h2 id="row-number\u51FD\u6570" tabindex="-1">row_number\u51FD\u6570 <a class="header-anchor" href="#row-number\u51FD\u6570" aria-hidden="true">#</a></h2><p>row_number\u51FD\u6570\u7528\u4E8E\u7A97\u53E3\u5206\u533A\u5185\u503C\u7684\u6392\u540D\u3002\u6BCF\u4E2A\u503C\u62E5\u6709\u552F\u4E00\u7684\u5E8F\u53F7\uFF0C\u4ECE1\u5F00\u59CB\u3002</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki"><code><span class="line"><span style="color:#82AAFF;">row_number</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">over</span><span style="color:#A6ACCD;"> (</span></span>\n<span class="line"><span style="color:#A6ACCD;">    [partition by partition_expression]</span></span>\n<span class="line"><span style="color:#A6ACCD;">    [order by order_expression]</span></span>\n<span class="line"><span style="color:#A6ACCD;">)</span></span>\n<span class="line"></span></code></pre></div><table><thead><tr><th>\u53C2\u6570</th><th>\u8BF4\u660E</th></tr></thead><tbody><tr><td>partition by <em>partition_expression</em></td><td>\u7A97\u53E3\u5206\u533A\uFF0C\u6839\u636E\u5206\u533A\u8868\u8FBE\u5F0F\u5C06\u6570\u636E\u5212\u5206\u6210\u4E0D\u540C\u7684\u5206\u533A\u3002</td></tr><tr><td>order by <em>order_expression</em></td><td>\u7A97\u53E3\u6392\u5E8F\uFF0C\u6839\u636E\u6392\u5E8F\u8868\u8FBE\u5F0F\u5BF9\u5404\u4E2A\u5206\u533A\u5185\u7684\u6BCF\u4E00\u884C\u8FDB\u884C\u6392\u5E8F\u3002</td></tr></tbody></table><p>bigint\u7C7B\u578B\u3002</p><p>\u6309\u7167\u90E8\u95E8\u5206\u533A\uFF0C\u8BA1\u7B97\u5458\u5DE5\u85AA\u6C34\u5728\u90E8\u95E8\u5185\u7684\u6392\u540D\u3002</p><ul><li><p>\u67E5\u8BE2\u548C\u5206\u6790\u8BED\u53E5</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> |</span></span>\n<span class="line"><span style="color:#F78C6C;">select</span></span>\n<span class="line"><span style="color:#A6ACCD;">  department,</span></span>\n<span class="line"><span style="color:#A6ACCD;">  staff_name,</span></span>\n<span class="line"><span style="color:#A6ACCD;">  salary,</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">row_number</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">over</span><span style="color:#A6ACCD;">(</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">partition</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">by</span><span style="color:#A6ACCD;"> department</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">order by</span></span>\n<span class="line"><span style="color:#A6ACCD;">      salary </span><span style="color:#F78C6C;">desc</span></span>\n<span class="line"><span style="color:#A6ACCD;">  ) </span><span style="color:#F78C6C;">as</span><span style="color:#A6ACCD;"> salary_rank</span></span>\n<span class="line"><span style="color:#F78C6C;">order by</span></span>\n<span class="line"><span style="color:#A6ACCD;">  department,</span></span>\n<span class="line"><span style="color:#A6ACCD;">  salary_rank</span></span>\n<span class="line"></span></code></pre></div></li><li><p>\u67E5\u8BE2\u548C\u5206\u6790\u7ED3\u679C</p><p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/7115699261/p311633.png" alt="row_number"></p></li></ul><h2 id="first-value\u51FD\u6570" tabindex="-1">first_value\u51FD\u6570 <a class="header-anchor" href="#first-value\u51FD\u6570" aria-hidden="true">#</a></h2><p>first_value\u51FD\u6570\u7528\u4E8E\u8FD4\u56DE\u5404\u4E2A\u7A97\u53E3\u5206\u533A\u5185\u7B2C\u4E00\u884C\u7684\u503C\u3002</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki"><code><span class="line"><span style="color:#82AAFF;">first_value</span><span style="color:#A6ACCD;">(x) </span><span style="color:#F78C6C;">over</span><span style="color:#A6ACCD;"> (</span></span>\n<span class="line"><span style="color:#A6ACCD;">    [partition by partition_expression]</span></span>\n<span class="line"><span style="color:#A6ACCD;">    [order by order_expression]</span></span>\n<span class="line"><span style="color:#A6ACCD;">    [frame]</span></span>\n<span class="line"><span style="color:#A6ACCD;">)</span></span>\n<span class="line"></span></code></pre></div><table><thead><tr><th>\u53C2\u6570</th><th>\u8BF4\u660E</th></tr></thead><tbody><tr><td><em>x</em></td><td>\u5217\u540D\uFF0C\u53EF\u4EE5\u4E3A\u4EFB\u610F\u6570\u636E\u7C7B\u578B\u3002</td></tr><tr><td>partition by <em>partition_expression</em></td><td>\u7A97\u53E3\u5206\u533A\uFF0C\u6839\u636E\u5206\u533A\u8868\u8FBE\u5F0F\u5C06\u6570\u636E\u5212\u5206\u6210\u4E0D\u540C\u7684\u5206\u533A\u3002</td></tr><tr><td>order by <em>order_expression</em></td><td>\u7A97\u53E3\u6392\u5E8F\uFF0C\u6839\u636E\u6392\u5E8F\u8868\u8FBE\u5F0F\u5BF9\u5404\u4E2A\u5206\u533A\u5185\u7684\u6BCF\u4E00\u884C\u8FDB\u884C\u6392\u5E8F\u3002</td></tr><tr><td><em>frame</em></td><td>\u7A97\u53E3\u6846\u67B6\uFF0C\u4F8B\u5982<code>range between unbounded preceding and unbounded following</code>\u3002</td></tr></tbody></table><p>\u4E0E <em>x</em> \u7684\u6570\u636E\u7C7B\u578B\u4E00\u81F4\u3002</p><p>\u83B7\u53D6\u76EE\u6807OSS Bucket\u4E2D\u5404\u4E2A\u5BF9\u8C61\u7684\u6700\u5C0F\u503C\u3002</p><ul><li><p>\u67E5\u8BE2\u548C\u5206\u6790\u8BED\u53E5</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">bucket :bucket90 |</span></span>\n<span class="line"><span style="color:#F78C6C;">select</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">object</span><span style="color:#A6ACCD;">,</span></span>\n<span class="line"><span style="color:#A6ACCD;">  object_size,</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">last_value</span><span style="color:#A6ACCD;">(object_size) </span><span style="color:#F78C6C;">over</span><span style="color:#A6ACCD;"> (</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">partition</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">by</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">object</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">order by</span></span>\n<span class="line"><span style="color:#A6ACCD;">      object_size </span></span>\n<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#F78C6C;">range</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">between</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">unbounded</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">preceding</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">and</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">unbounded</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">following</span></span>\n<span class="line"><span style="color:#A6ACCD;">  ) </span><span style="color:#F78C6C;">as</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">last_value</span></span>\n<span class="line"><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;">  oss</span><span style="color:#89DDFF;">-</span><span style="color:#82AAFF;">log</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">store</span></span>\n<span class="line"></span></code></pre></div></li><li><p>\u67E5\u8BE2\u548C\u5206\u6790\u7ED3\u679C</p><p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/6621499261/p312466.png" alt="first_value"></p></li></ul><h2 id="last-value\u51FD\u6570" tabindex="-1">last_value\u51FD\u6570 <a class="header-anchor" href="#last-value\u51FD\u6570" aria-hidden="true">#</a></h2><p>last_value\u51FD\u6570\u7528\u4E8E\u8FD4\u56DE\u5404\u4E2A\u7A97\u53E3\u5206\u533A\u5185\u6700\u540E\u4E00\u884C\u7684\u503C\u3002</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki"><code><span class="line"><span style="color:#82AAFF;">last_value</span><span style="color:#A6ACCD;">(x) </span><span style="color:#F78C6C;">over</span><span style="color:#A6ACCD;"> (</span></span>\n<span class="line"><span style="color:#A6ACCD;">    [partition by partition_expression]</span></span>\n<span class="line"><span style="color:#A6ACCD;">    [order by order_expression]</span></span>\n<span class="line"><span style="color:#A6ACCD;">    [frame]</span></span>\n<span class="line"><span style="color:#A6ACCD;">)</span></span>\n<span class="line"></span></code></pre></div><table><thead><tr><th>\u53C2\u6570</th><th>\u8BF4\u660E</th></tr></thead><tbody><tr><td><em>x</em></td><td>\u5217\u540D\uFF0C\u53EF\u4EE5\u4E3A\u4EFB\u610F\u6570\u636E\u7C7B\u578B\u3002</td></tr><tr><td>partition by <em>partition_expression</em></td><td>\u7A97\u53E3\u5206\u533A\uFF0C\u6839\u636E\u5206\u533A\u8868\u8FBE\u5F0F\u5C06\u6570\u636E\u5212\u5206\u6210\u4E0D\u540C\u7684\u5206\u533A\u3002</td></tr><tr><td>order by <em>order_expression</em></td><td>\u7A97\u53E3\u6392\u5E8F\uFF0C\u6839\u636E\u6392\u5E8F\u8868\u8FBE\u5F0F\u5BF9\u5404\u4E2A\u5206\u533A\u5185\u7684\u6BCF\u4E00\u884C\u8FDB\u884C\u6392\u5E8F\u3002</td></tr><tr><td><em>frame</em></td><td>\u7A97\u53E3\u6846\u67B6\uFF0C\u4F8B\u5982<code>range between unbounded preceding and unbounded following</code>\u3002</td></tr></tbody></table><p>\u4E0E <em>x</em> \u7684\u6570\u636E\u7C7B\u578B\u4E00\u81F4\u3002</p><p>\u83B7\u53D6\u76EE\u6807OSS Bucket\u4E2D\u5404\u4E2A\u5BF9\u8C61\u7684\u6700\u5927\u503C\u3002</p><ul><li><p>\u67E5\u8BE2\u548C\u5206\u6790\u8BED\u53E5</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">bucket :bucket90 |</span></span>\n<span class="line"><span style="color:#F78C6C;">select</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">object</span><span style="color:#A6ACCD;">,</span></span>\n<span class="line"><span style="color:#A6ACCD;">  object_size,</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">last_value</span><span style="color:#A6ACCD;">(object_size) </span><span style="color:#F78C6C;">over</span><span style="color:#A6ACCD;"> (</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">partition</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">by</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">object</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">order by</span></span>\n<span class="line"><span style="color:#A6ACCD;">      object_size </span></span>\n<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#F78C6C;">range</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">between</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">unbounded</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">preceding</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">and</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">unbounded</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">following</span></span>\n<span class="line"><span style="color:#A6ACCD;">  ) </span><span style="color:#F78C6C;">as</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">last_value</span></span>\n<span class="line"><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;">  oss</span><span style="color:#89DDFF;">-</span><span style="color:#82AAFF;">log</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">store</span></span>\n<span class="line"></span></code></pre></div></li><li><p>\u67E5\u8BE2\u548C\u5206\u6790\u7ED3\u679C</p><p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/7621499261/p312463.png" alt="last_value"></p></li></ul><h2 id="lag\u51FD\u6570" tabindex="-1">lag\u51FD\u6570 <a class="header-anchor" href="#lag\u51FD\u6570" aria-hidden="true">#</a></h2><p>lag\u51FD\u6570\u7528\u4E8E\u8FD4\u56DE\u7A97\u53E3\u5206\u533A\u5185\u4F4D\u4E8E\u5F53\u524D\u884C\u4E0A\u65B9\u7B2C <em>offset</em> \u884C\u7684\u503C\u3002</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki"><code><span class="line"><span style="color:#82AAFF;">lag</span><span style="color:#A6ACCD;">(x, offset, defaut_value) </span><span style="color:#F78C6C;">over</span><span style="color:#A6ACCD;"> (</span></span>\n<span class="line"><span style="color:#A6ACCD;">    [partition by partition_expression]</span></span>\n<span class="line"><span style="color:#A6ACCD;">    [order by order_expression]</span></span>\n<span class="line"><span style="color:#A6ACCD;">    [frame]</span></span>\n<span class="line"><span style="color:#A6ACCD;">)</span></span>\n<span class="line"></span></code></pre></div><table><thead><tr><th>\u53C2\u6570</th><th>\u8BF4\u660E</th></tr></thead><tbody><tr><td><em>x</em></td><td>\u5217\u540D\uFF0C\u53EF\u4EE5\u4E3A\u4EFB\u610F\u6570\u636E\u7C7B\u578B\u3002</td></tr><tr><td><em>offset</em></td><td>\u504F\u79BB\u91CF\u3002\u5982\u679C <em>offset</em> \u4E3A0\uFF0C\u5219\u8FD4\u56DE\u5F53\u524D\u884C\u7684\u503C\u3002</td></tr><tr><td><em>defaut_value</em></td><td>\u5982\u679C\u4E0D\u5B58\u5728\u6307\u5B9A\u7684\u504F\u79BB\u884C\uFF0C\u5219\u8FD4\u56DE <em>defaut_value</em> \u3002</td></tr><tr><td>partition by <em>partition_expression</em></td><td>\u7A97\u53E3\u5206\u533A\uFF0C\u6839\u636E\u5206\u533A\u8868\u8FBE\u5F0F\u5C06\u6570\u636E\u5212\u5206\u6210\u4E0D\u540C\u7684\u5206\u533A\u3002</td></tr><tr><td>order by <em>order_expression</em></td><td>\u7A97\u53E3\u6392\u5E8F\uFF0C\u6839\u636E\u6392\u5E8F\u8868\u8FBE\u5F0F\u5BF9\u5404\u4E2A\u5206\u533A\u5185\u7684\u6BCF\u4E00\u884C\u8FDB\u884C\u6392\u5E8F\u3002</td></tr><tr><td><em>frame</em></td><td>\u7A97\u53E3\u6846\u67B6\uFF0C\u4F8B\u5982<code>range between unbounded preceding and unbounded following</code>\u3002</td></tr></tbody></table><p>\u4E0E <em>x</em> \u7684\u6570\u636E\u7C7B\u578B\u4E00\u81F4\u3002</p><p>\u6309\u5929\u7EDF\u8BA1\u7F51\u7AD9\u8BBF\u95EEUV\uFF0C\u83B7\u53D6\u6BCF\u5929\u7F51\u7AD9\u8BBF\u95EEUV\u76F8\u6BD4\u524D\u4E00\u5929\u7684\u589E\u957F\u60C5\u51B5\u3002</p><ul><li><p>\u67E5\u8BE2\u548C\u5206\u6790\u8BED\u53E5</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki has-diff"><code><span class="line"><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> |</span></span>\n<span class="line"><span style="color:#F78C6C;">select</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">day</span><span style="color:#A6ACCD;">,</span></span>\n<span class="line"><span style="color:#A6ACCD;">  UV,</span></span>\n<span class="line"><span style="color:#A6ACCD;">  UV </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">lag</span><span style="color:#A6ACCD;">(UV, </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">over</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">as</span><span style="color:#A6ACCD;"> diff_percentage</span></span>\n<span class="line"><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;">  (</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">select</span></span>\n<span class="line"><span style="color:#A6ACCD;">      approx_distinct(client_ip) </span><span style="color:#F78C6C;">as</span><span style="color:#A6ACCD;"> UV,</span></span>\n<span class="line"><span style="color:#A6ACCD;">      date_trunc(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">day</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, __time__) </span><span style="color:#F78C6C;">as</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">day</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">log</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">group by</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#82AAFF;">day</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">order by</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#82AAFF;">day</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">asc</span></span>\n<span class="line"><span style="color:#A6ACCD;">  )</span></span>\n<span class="line"></span></code></pre></div></li><li><p>\u67E5\u8BE2\u548C\u5206\u6790\u7ED3\u679C</p><p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/0659558261/p302458.png" alt="\u7A97\u53E3\u51FD\u6570"></p></li></ul><h2 id="lead\u51FD\u6570" tabindex="-1">lead\u51FD\u6570 <a class="header-anchor" href="#lead\u51FD\u6570" aria-hidden="true">#</a></h2><p>\u51FD\u6570\u7528\u4E8E\u8FD4\u56DE\u7A97\u53E3\u5206\u533A\u5185\u4F4D\u4E8E\u5F53\u524D\u884C\u4E0B\u65B9\u7B2C <em>offset</em> \u884C\u7684\u503C\u3002</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki"><code><span class="line"><span style="color:#82AAFF;">lead</span><span style="color:#A6ACCD;">(x, offset, defaut_value) </span><span style="color:#F78C6C;">over</span><span style="color:#A6ACCD;"> (</span></span>\n<span class="line"><span style="color:#A6ACCD;">    [partition by partition_expression]</span></span>\n<span class="line"><span style="color:#A6ACCD;">    [order by order_expression]</span></span>\n<span class="line"><span style="color:#A6ACCD;">    [frame]</span></span>\n<span class="line"><span style="color:#A6ACCD;">)</span></span>\n<span class="line"></span></code></pre></div><table><thead><tr><th>\u53C2\u6570</th><th>\u8BF4\u660E</th></tr></thead><tbody><tr><td><em>x</em></td><td>\u5217\u540D\uFF0C\u53EF\u4EE5\u4E3A\u4EFB\u610F\u6570\u636E\u7C7B\u578B\u3002</td></tr><tr><td><em>offset</em></td><td>\u504F\u79BB\u91CF\u3002\u5982\u679C <em>offset</em> \u4E3A0\uFF0C\u5219\u8FD4\u56DE\u5F53\u524D\u884C\u7684\u503C\u3002</td></tr><tr><td><em>defaut_value</em></td><td>\u5982\u679C\u4E0D\u5B58\u5728\u6307\u5B9A\u7684\u504F\u79BB\u884C\uFF0C\u5219\u8FD4\u56DE <em>defaut_value</em> \u3002</td></tr><tr><td>partition by <em>partition_expression</em></td><td>\u7A97\u53E3\u5206\u533A\uFF0C\u6839\u636E\u5206\u533A\u8868\u8FBE\u5F0F\u5C06\u6570\u636E\u5212\u5206\u6210\u4E0D\u540C\u7684\u5206\u533A\u3002</td></tr><tr><td>order by <em>order_expression</em></td><td>\u7A97\u53E3\u6392\u5E8F\uFF0C\u6839\u636E\u6392\u5E8F\u8868\u8FBE\u5F0F\u5BF9\u5404\u4E2A\u5206\u533A\u5185\u7684\u6BCF\u4E00\u884C\u8FDB\u884C\u6392\u5E8F\u3002</td></tr><tr><td><em>frame</em></td><td>\u7A97\u53E3\u6846\u67B6\uFF0C\u4F8B\u5982<code>range between unbounded preceding and unbounded following</code>\u3002</td></tr></tbody></table><p>\u4E0E <em>x</em> \u7684\u6570\u636E\u7C7B\u578B\u4E00\u81F4\u3002</p><p>\u8BA1\u7B972021-08-26\u5F53\u5929\uFF0C\u5F53\u524D\u4E00\u5C0F\u65F6\u7F51\u7AD9\u8BBF\u95EEUV\u4E0E\u540E\u4E00\u5C0F\u65F6\u7684\u5360\u6BD4\u60C5\u51B5\u3002</p><ul><li><p>\u67E5\u8BE2\u548C\u5206\u6790\u8BED\u53E5</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki has-diff"><code><span class="line"><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> |</span></span>\n<span class="line"><span style="color:#F78C6C;">select</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">time</span><span style="color:#A6ACCD;">,</span></span>\n<span class="line"><span style="color:#A6ACCD;">  UV,</span></span>\n<span class="line"><span style="color:#A6ACCD;">  UV </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">lead</span><span style="color:#A6ACCD;">(UV, </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">over</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">as</span><span style="color:#A6ACCD;"> diff_percentage</span></span>\n<span class="line"><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;">  (</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">select</span></span>\n<span class="line"><span style="color:#A6ACCD;">      approx_distinct(client_ip) </span><span style="color:#F78C6C;">as</span><span style="color:#A6ACCD;"> uv,</span></span>\n<span class="line"><span style="color:#A6ACCD;">      date_trunc(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hour</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, __time__) </span><span style="color:#F78C6C;">as</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">time</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">log</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">group by</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">time</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">order by</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">time</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">asc</span></span>\n<span class="line"><span style="color:#A6ACCD;">  )</span></span>\n<span class="line"></span></code></pre></div></li><li><p>\u67E5\u8BE2\u548C\u5206\u6790\u7ED3\u679C</p><p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/7115699261/p312579.png" alt="lead"></p></li></ul><h2 id="nth-value\u51FD\u6570" tabindex="-1">nth_value\u51FD\u6570 <a class="header-anchor" href="#nth-value\u51FD\u6570" aria-hidden="true">#</a></h2><p>nth_value\u51FD\u6570\u7528\u4E8E\u8FD4\u56DE\u7A97\u53E3\u5206\u533A\u4E2D\u7B2C <em>offset</em> \u884C\u7684\u503C\u3002</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">nth_value(x, offset) </span><span style="color:#F78C6C;">over</span><span style="color:#A6ACCD;"> (</span></span>\n<span class="line"><span style="color:#A6ACCD;">    [partition by partition_expression]</span></span>\n<span class="line"><span style="color:#A6ACCD;">    [order by order_expression]</span></span>\n<span class="line"><span style="color:#A6ACCD;">    [frame]</span></span>\n<span class="line"><span style="color:#A6ACCD;">)</span></span>\n<span class="line"></span></code></pre></div><table><thead><tr><th>\u53C2\u6570</th><th>\u8BF4\u660E</th></tr></thead><tbody><tr><td><em>x</em></td><td>\u5217\u540D\uFF0C\u53EF\u4EE5\u4E3A\u4EFB\u610F\u6570\u636E\u7C7B\u578B\u3002</td></tr><tr><td><em>offset</em></td><td>\u504F\u79BB\u91CF\u3002</td></tr><tr><td>partition by <em>partition_expression</em></td><td>\u7A97\u53E3\u5206\u533A\uFF0C\u6839\u636E\u5206\u533A\u8868\u8FBE\u5F0F\u5C06\u6570\u636E\u5212\u5206\u6210\u4E0D\u540C\u7684\u5206\u533A\u3002</td></tr><tr><td>order by <em>order_expression</em></td><td>\u7A97\u53E3\u6392\u5E8F\uFF0C\u6839\u636E\u6392\u5E8F\u8868\u8FBE\u5F0F\u5BF9\u5404\u4E2A\u5206\u533A\u5185\u7684\u6BCF\u4E00\u884C\u8FDB\u884C\u6392\u5E8F\u3002</td></tr><tr><td><em>frame</em></td><td>\u7A97\u53E3\u6846\u67B6\uFF0C\u4F8B\u5982<code>range between unbounded preceding and unbounded following</code>\u3002</td></tr></tbody></table><p>\u4E0E <em>x</em> \u7684\u6570\u636E\u7C7B\u578B\u4E00\u81F4\u3002</p><p>\u6309\u7167\u90E8\u95E8\u5206\u533A\uFF0C\u7EDF\u8BA1\u5404\u4E2A\u90E8\u95E8\u4E2D\u85AA\u6C34\u7B2C\u4E8C\u9AD8\u7684\u5458\u5DE5\u3002</p><ul><li><p>\u67E5\u8BE2\u548C\u5206\u6790\u8BED\u53E5</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> |</span></span>\n<span class="line"><span style="color:#F78C6C;">select</span></span>\n<span class="line"><span style="color:#A6ACCD;">  department,</span></span>\n<span class="line"><span style="color:#A6ACCD;">  staff_name,</span></span>\n<span class="line"><span style="color:#A6ACCD;">  salary,</span></span>\n<span class="line"><span style="color:#A6ACCD;">  nth_value(staff_name, </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">over</span><span style="color:#A6ACCD;">(</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">partition</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">by</span><span style="color:#A6ACCD;"> department</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">order by</span></span>\n<span class="line"><span style="color:#A6ACCD;">      sallary </span><span style="color:#F78C6C;">desc</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">range</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">between</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">unbounded</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">preceding</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">and</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">unbounded</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">following</span></span>\n<span class="line"><span style="color:#A6ACCD;">  ) </span><span style="color:#F78C6C;">as</span><span style="color:#A6ACCD;"> second_highest_sallary </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">log</span></span>\n<span class="line"></span></code></pre></div></li><li><p>\u67E5\u8BE2\u548C\u5206\u6790\u7ED3\u679C</p><p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/7115699261/p312634.png" alt="nth_value"></p></li></ul>', 94);
const _hoisted_95 = [
  _hoisted_1
];
function _sfc_render(_ctx, _cache, $props, $setup, $data, $options) {
  return openBlock(), createElementBlock("div", null, _hoisted_95);
}
const _13_________ = /* @__PURE__ */ _export_sfc(_sfc_main, [["render", _sfc_render]]);
export {
  __pageData,
  _13_________ as default
};
